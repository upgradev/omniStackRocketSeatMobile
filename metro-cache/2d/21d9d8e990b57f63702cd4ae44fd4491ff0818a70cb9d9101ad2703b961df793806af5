{"dependencies":[{"name":"isarray","data":{"isAsync":false}},{"name":"./is-buffer","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var isArray = _$$_REQUIRE(_dependencyMap[0], \"isarray\");\n\n  var isBuf = _$$_REQUIRE(_dependencyMap[1], \"./is-buffer\");\n\n  var toString = Object.prototype.toString;\n  var withNativeBlob = typeof Blob === 'function' || typeof Blob !== 'undefined' && toString.call(Blob) === '[object BlobConstructor]';\n  var withNativeFile = typeof File === 'function' || typeof File !== 'undefined' && toString.call(File) === '[object FileConstructor]';\n\n  exports.deconstructPacket = function (packet) {\n    var buffers = [];\n    var packetData = packet.data;\n    var pack = packet;\n    pack.data = _deconstructPacket(packetData, buffers);\n    pack.attachments = buffers.length;\n    return {\n      packet: pack,\n      buffers: buffers\n    };\n  };\n\n  function _deconstructPacket(data, buffers) {\n    if (!data) return data;\n\n    if (isBuf(data)) {\n      var placeholder = {\n        _placeholder: true,\n        num: buffers.length\n      };\n      buffers.push(data);\n      return placeholder;\n    } else if (isArray(data)) {\n      var newData = new Array(data.length);\n\n      for (var i = 0; i < data.length; i++) {\n        newData[i] = _deconstructPacket(data[i], buffers);\n      }\n\n      return newData;\n    } else if (typeof data === 'object' && !(data instanceof Date)) {\n      var newData = {};\n\n      for (var key in data) {\n        newData[key] = _deconstructPacket(data[key], buffers);\n      }\n\n      return newData;\n    }\n\n    return data;\n  }\n\n  exports.reconstructPacket = function (packet, buffers) {\n    packet.data = _reconstructPacket(packet.data, buffers);\n    packet.attachments = undefined;\n    return packet;\n  };\n\n  function _reconstructPacket(data, buffers) {\n    if (!data) return data;\n\n    if (data && data._placeholder) {\n      return buffers[data.num];\n    } else if (isArray(data)) {\n      for (var i = 0; i < data.length; i++) {\n        data[i] = _reconstructPacket(data[i], buffers);\n      }\n    } else if (typeof data === 'object') {\n      for (var key in data) {\n        data[key] = _reconstructPacket(data[key], buffers);\n      }\n    }\n\n    return data;\n  }\n\n  exports.removeBlobs = function (data, callback) {\n    function _removeBlobs(obj, curKey, containingObject) {\n      if (!obj) return obj;\n\n      if (withNativeBlob && obj instanceof Blob || withNativeFile && obj instanceof File) {\n        pendingBlobs++;\n        var fileReader = new FileReader();\n\n        fileReader.onload = function () {\n          if (containingObject) {\n            containingObject[curKey] = this.result;\n          } else {\n            bloblessData = this.result;\n          }\n\n          if (! --pendingBlobs) {\n            callback(bloblessData);\n          }\n        };\n\n        fileReader.readAsArrayBuffer(obj);\n      } else if (isArray(obj)) {\n        for (var i = 0; i < obj.length; i++) {\n          _removeBlobs(obj[i], i, obj);\n        }\n      } else if (typeof obj === 'object' && !isBuf(obj)) {\n        for (var key in obj) {\n          _removeBlobs(obj[key], key, obj);\n        }\n      }\n    }\n\n    var pendingBlobs = 0;\n    var bloblessData = data;\n\n    _removeBlobs(bloblessData);\n\n    if (!pendingBlobs) {\n      callback(bloblessData);\n    }\n  };\n});","map":[[2,0,7,0],[2,6,7,4,"isArray"],[2,13,7,11],[2,16,7,14,"require"],[2,27,7,21],[2,57,7,0],[4,0,8,0],[4,6,8,4,"isBuf"],[4,11,8,9],[4,14,8,12,"require"],[4,25,8,19],[4,59,8,0],[6,0,9,0],[6,6,9,4,"toString"],[6,14,9,12],[6,17,9,15,"Object"],[6,23,9,21],[6,24,9,22,"prototype"],[6,33,9,15],[6,34,9,32,"toString"],[6,42,9,0],[7,0,10,0],[7,6,10,4,"withNativeBlob"],[7,20,10,18],[7,23,10,21],[7,30,10,28,"Blob"],[7,34,10,21],[7,39,10,37],[7,49,10,21],[7,53,10,52],[7,60,10,59,"Blob"],[7,64,10,52],[7,69,10,68],[7,80,10,52],[7,84,10,83,"toString"],[7,92,10,91],[7,93,10,92,"call"],[7,97,10,83],[7,98,10,97,"Blob"],[7,102,10,83],[7,108,10,107],[7,134,10,0],[8,0,11,0],[8,6,11,4,"withNativeFile"],[8,20,11,18],[8,23,11,21],[8,30,11,28,"File"],[8,34,11,21],[8,39,11,37],[8,49,11,21],[8,53,11,52],[8,60,11,59,"File"],[8,64,11,52],[8,69,11,68],[8,80,11,52],[8,84,11,83,"toString"],[8,92,11,91],[8,93,11,92,"call"],[8,97,11,83],[8,98,11,97,"File"],[8,102,11,83],[8,108,11,107],[8,134,11,0],[10,0,23,0,"exports"],[10,2,23,0,"exports"],[10,9,23,7],[10,10,23,8,"deconstructPacket"],[10,27,23,0],[10,30,23,28],[10,40,23,37,"packet"],[10,46,23,28],[10,48,23,45],[11,0,24,2],[11,8,24,6,"buffers"],[11,15,24,13],[11,18,24,16],[11,20,24,2],[12,0,25,2],[12,8,25,6,"packetData"],[12,18,25,16],[12,21,25,19,"packet"],[12,27,25,25],[12,28,25,26,"data"],[12,32,25,2],[13,0,26,2],[13,8,26,6,"pack"],[13,12,26,10],[13,15,26,13,"packet"],[13,21,26,2],[14,0,27,2,"pack"],[14,4,27,2,"pack"],[14,8,27,6],[14,9,27,7,"data"],[14,13,27,2],[14,16,27,14,"_deconstructPacket"],[14,34,27,32],[14,35,27,33,"packetData"],[14,45,27,32],[14,47,27,45,"buffers"],[14,54,27,32],[14,55,27,2],[15,0,28,2,"pack"],[15,4,28,2,"pack"],[15,8,28,6],[15,9,28,7,"attachments"],[15,20,28,2],[15,23,28,21,"buffers"],[15,30,28,28],[15,31,28,29,"length"],[15,37,28,2],[16,0,29,2],[16,11,29,9],[17,0,29,10,"packet"],[17,6,29,10,"packet"],[17,12,29,16],[17,14,29,18,"pack"],[17,18,29,9],[18,0,29,24,"buffers"],[18,6,29,24,"buffers"],[18,13,29,31],[18,15,29,33,"buffers"],[19,0,29,9],[19,5,29,2],[20,0,30,1],[20,3,23,0],[22,0,32,0],[22,11,32,9,"_deconstructPacket"],[22,29,32,0],[22,30,32,28,"data"],[22,34,32,0],[22,36,32,34,"buffers"],[22,43,32,0],[22,45,32,43],[23,0,33,2],[23,8,33,6],[23,9,33,7,"data"],[23,13,33,2],[23,15,33,13],[23,22,33,20,"data"],[23,26,33,13],[25,0,35,2],[25,8,35,6,"isBuf"],[25,13,35,11],[25,14,35,12,"data"],[25,18,35,11],[25,19,35,2],[25,21,35,19],[26,0,36,4],[26,10,36,8,"placeholder"],[26,21,36,19],[26,24,36,22],[27,0,36,24,"_placeholder"],[27,8,36,24,"_placeholder"],[27,20,36,36],[27,22,36,38],[27,26,36,22],[28,0,36,44,"num"],[28,8,36,44,"num"],[28,11,36,47],[28,13,36,49,"buffers"],[28,20,36,56],[28,21,36,57,"length"],[29,0,36,22],[29,7,36,4],[30,0,37,4,"buffers"],[30,6,37,4,"buffers"],[30,13,37,11],[30,14,37,12,"push"],[30,18,37,4],[30,19,37,17,"data"],[30,23,37,4],[31,0,38,4],[31,13,38,11,"placeholder"],[31,24,38,4],[32,0,39,3],[32,5,35,2],[32,11,39,9],[32,15,39,13,"isArray"],[32,22,39,20],[32,23,39,21,"data"],[32,27,39,20],[32,28,39,9],[32,30,39,28],[33,0,40,4],[33,10,40,8,"newData"],[33,17,40,15],[33,20,40,18],[33,24,40,22,"Array"],[33,29,40,18],[33,30,40,28,"data"],[33,34,40,32],[33,35,40,33,"length"],[33,41,40,18],[33,42,40,4],[35,0,41,4],[35,11,41,9],[35,15,41,13,"i"],[35,16,41,14],[35,19,41,17],[35,20,41,4],[35,22,41,20,"i"],[35,23,41,21],[35,26,41,24,"data"],[35,30,41,28],[35,31,41,29,"length"],[35,37,41,4],[35,39,41,37,"i"],[35,40,41,38],[35,42,41,4],[35,44,41,42],[36,0,42,6,"newData"],[36,8,42,6,"newData"],[36,15,42,13],[36,16,42,14,"i"],[36,17,42,13],[36,18,42,6],[36,21,42,19,"_deconstructPacket"],[36,39,42,37],[36,40,42,38,"data"],[36,44,42,42],[36,45,42,43,"i"],[36,46,42,42],[36,47,42,37],[36,49,42,47,"buffers"],[36,56,42,37],[36,57,42,6],[37,0,43,5],[39,0,44,4],[39,13,44,11,"newData"],[39,20,44,4],[40,0,45,3],[40,5,39,9],[40,11,45,9],[40,15,45,13],[40,22,45,20,"data"],[40,26,45,13],[40,31,45,29],[40,39,45,13],[40,43,45,41],[40,45,45,43,"data"],[40,49,45,47],[40,61,45,59,"Date"],[40,65,45,41],[40,66,45,9],[40,68,45,66],[41,0,46,4],[41,10,46,8,"newData"],[41,17,46,15],[41,20,46,18],[41,22,46,4],[43,0,47,4],[43,11,47,9],[43,15,47,13,"key"],[43,18,47,4],[43,22,47,20,"data"],[43,26,47,4],[43,28,47,26],[44,0,48,6,"newData"],[44,8,48,6,"newData"],[44,15,48,13],[44,16,48,14,"key"],[44,19,48,13],[44,20,48,6],[44,23,48,21,"_deconstructPacket"],[44,41,48,39],[44,42,48,40,"data"],[44,46,48,44],[44,47,48,45,"key"],[44,50,48,44],[44,51,48,39],[44,53,48,51,"buffers"],[44,60,48,39],[44,61,48,6],[45,0,49,5],[47,0,50,4],[47,13,50,11,"newData"],[47,20,50,4],[48,0,51,3],[50,0,52,2],[50,11,52,9,"data"],[50,15,52,2],[51,0,53,1],[53,0,64,0,"exports"],[53,2,64,0,"exports"],[53,9,64,7],[53,10,64,8,"reconstructPacket"],[53,27,64,0],[53,30,64,28],[53,40,64,37,"packet"],[53,46,64,28],[53,48,64,45,"buffers"],[53,55,64,28],[53,57,64,54],[54,0,65,2,"packet"],[54,4,65,2,"packet"],[54,10,65,8],[54,11,65,9,"data"],[54,15,65,2],[54,18,65,16,"_reconstructPacket"],[54,36,65,34],[54,37,65,35,"packet"],[54,43,65,41],[54,44,65,42,"data"],[54,48,65,34],[54,50,65,48,"buffers"],[54,57,65,34],[54,58,65,2],[55,0,66,2,"packet"],[55,4,66,2,"packet"],[55,10,66,8],[55,11,66,9,"attachments"],[55,22,66,2],[55,25,66,23,"undefined"],[55,34,66,2],[56,0,67,2],[56,11,67,9,"packet"],[56,17,67,2],[57,0,68,1],[57,3,64,0],[59,0,70,0],[59,11,70,9,"_reconstructPacket"],[59,29,70,0],[59,30,70,28,"data"],[59,34,70,0],[59,36,70,34,"buffers"],[59,43,70,0],[59,45,70,43],[60,0,71,2],[60,8,71,6],[60,9,71,7,"data"],[60,13,71,2],[60,15,71,13],[60,22,71,20,"data"],[60,26,71,13],[62,0,73,2],[62,8,73,6,"data"],[62,12,73,10],[62,16,73,14,"data"],[62,20,73,18],[62,21,73,19,"_placeholder"],[62,33,73,2],[62,35,73,33],[63,0,74,4],[63,13,74,11,"buffers"],[63,20,74,18],[63,21,74,19,"data"],[63,25,74,23],[63,26,74,24,"num"],[63,29,74,18],[63,30,74,4],[64,0,75,3],[64,5,73,2],[64,11,75,9],[64,15,75,13,"isArray"],[64,22,75,20],[64,23,75,21,"data"],[64,27,75,20],[64,28,75,9],[64,30,75,28],[65,0,76,4],[65,11,76,9],[65,15,76,13,"i"],[65,16,76,14],[65,19,76,17],[65,20,76,4],[65,22,76,20,"i"],[65,23,76,21],[65,26,76,24,"data"],[65,30,76,28],[65,31,76,29,"length"],[65,37,76,4],[65,39,76,37,"i"],[65,40,76,38],[65,42,76,4],[65,44,76,42],[66,0,77,6,"data"],[66,8,77,6,"data"],[66,12,77,10],[66,13,77,11,"i"],[66,14,77,10],[66,15,77,6],[66,18,77,16,"_reconstructPacket"],[66,36,77,34],[66,37,77,35,"data"],[66,41,77,39],[66,42,77,40,"i"],[66,43,77,39],[66,44,77,34],[66,46,77,44,"buffers"],[66,53,77,34],[66,54,77,6],[67,0,78,5],[68,0,79,3],[68,5,75,9],[68,11,79,9],[68,15,79,13],[68,22,79,20,"data"],[68,26,79,13],[68,31,79,29],[68,39,79,9],[68,41,79,39],[69,0,80,4],[69,11,80,9],[69,15,80,13,"key"],[69,18,80,4],[69,22,80,20,"data"],[69,26,80,4],[69,28,80,26],[70,0,81,6,"data"],[70,8,81,6,"data"],[70,12,81,10],[70,13,81,11,"key"],[70,16,81,10],[70,17,81,6],[70,20,81,18,"_reconstructPacket"],[70,38,81,36],[70,39,81,37,"data"],[70,43,81,41],[70,44,81,42,"key"],[70,47,81,41],[70,48,81,36],[70,50,81,48,"buffers"],[70,57,81,36],[70,58,81,6],[71,0,82,5],[72,0,83,3],[74,0,85,2],[74,11,85,9,"data"],[74,15,85,2],[75,0,86,1],[77,0,98,0,"exports"],[77,2,98,0,"exports"],[77,9,98,7],[77,10,98,8,"removeBlobs"],[77,21,98,0],[77,24,98,22],[77,34,98,31,"data"],[77,38,98,22],[77,40,98,37,"callback"],[77,48,98,22],[77,50,98,47],[78,0,99,2],[78,13,99,11,"_removeBlobs"],[78,25,99,2],[78,26,99,24,"obj"],[78,29,99,2],[78,31,99,29,"curKey"],[78,37,99,2],[78,39,99,37,"containingObject"],[78,55,99,2],[78,57,99,55],[79,0,100,4],[79,10,100,8],[79,11,100,9,"obj"],[79,14,100,4],[79,16,100,14],[79,23,100,21,"obj"],[79,26,100,14],[81,0,103,4],[81,10,103,9,"withNativeBlob"],[81,24,103,23],[81,28,103,27,"obj"],[81,31,103,30],[81,43,103,42,"Blob"],[81,47,103,8],[81,51,104,9,"withNativeFile"],[81,65,104,23],[81,69,104,27,"obj"],[81,72,104,30],[81,84,104,42,"File"],[81,88,103,4],[81,90,104,49],[82,0,105,6,"pendingBlobs"],[82,8,105,6,"pendingBlobs"],[82,20,105,18],[83,0,108,6],[83,12,108,10,"fileReader"],[83,22,108,20],[83,25,108,23],[83,29,108,27,"FileReader"],[83,39,108,23],[83,41,108,6],[85,0,109,6,"fileReader"],[85,8,109,6,"fileReader"],[85,18,109,16],[85,19,109,17,"onload"],[85,25,109,6],[85,28,109,26],[85,40,109,37],[86,0,110,8],[86,14,110,12,"containingObject"],[86,30,110,8],[86,32,110,30],[87,0,111,10,"containingObject"],[87,12,111,10,"containingObject"],[87,28,111,26],[87,29,111,27,"curKey"],[87,35,111,26],[87,36,111,10],[87,39,111,37],[87,44,111,42,"result"],[87,50,111,10],[88,0,112,9],[88,11,110,8],[88,17,113,13],[89,0,114,10,"bloblessData"],[89,12,114,10,"bloblessData"],[89,24,114,22],[89,27,114,25],[89,32,114,30,"result"],[89,38,114,10],[90,0,115,9],[92,0,118,8],[92,14,118,11],[92,15,118,13],[92,18,118,15,"pendingBlobs"],[92,30,118,8],[92,32,118,29],[93,0,119,10,"callback"],[93,12,119,10,"callback"],[93,20,119,18],[93,21,119,19,"bloblessData"],[93,33,119,18],[93,34,119,10],[94,0,120,9],[95,0,121,7],[95,9,109,6],[97,0,123,6,"fileReader"],[97,8,123,6,"fileReader"],[97,18,123,16],[97,19,123,17,"readAsArrayBuffer"],[97,36,123,6],[97,37,123,35,"obj"],[97,40,123,6],[98,0,124,5],[98,7,103,4],[98,13,124,11],[98,17,124,15,"isArray"],[98,24,124,22],[98,25,124,23,"obj"],[98,28,124,22],[98,29,124,11],[98,31,124,29],[99,0,125,6],[99,13,125,11],[99,17,125,15,"i"],[99,18,125,16],[99,21,125,19],[99,22,125,6],[99,24,125,22,"i"],[99,25,125,23],[99,28,125,26,"obj"],[99,31,125,29],[99,32,125,30,"length"],[99,38,125,6],[99,40,125,38,"i"],[99,41,125,39],[99,43,125,6],[99,45,125,43],[100,0,126,8,"_removeBlobs"],[100,10,126,8,"_removeBlobs"],[100,22,126,20],[100,23,126,21,"obj"],[100,26,126,24],[100,27,126,25,"i"],[100,28,126,24],[100,29,126,20],[100,31,126,29,"i"],[100,32,126,20],[100,34,126,32,"obj"],[100,37,126,20],[100,38,126,8],[101,0,127,7],[102,0,128,5],[102,7,124,11],[102,13,128,11],[102,17,128,15],[102,24,128,22,"obj"],[102,27,128,15],[102,32,128,30],[102,40,128,15],[102,44,128,42],[102,45,128,43,"isBuf"],[102,50,128,48],[102,51,128,49,"obj"],[102,54,128,48],[102,55,128,11],[102,57,128,55],[103,0,129,6],[103,13,129,11],[103,17,129,15,"key"],[103,20,129,6],[103,24,129,22,"obj"],[103,27,129,6],[103,29,129,27],[104,0,130,8,"_removeBlobs"],[104,10,130,8,"_removeBlobs"],[104,22,130,20],[104,23,130,21,"obj"],[104,26,130,24],[104,27,130,25,"key"],[104,30,130,24],[104,31,130,20],[104,33,130,31,"key"],[104,36,130,20],[104,38,130,36,"obj"],[104,41,130,20],[104,42,130,8],[105,0,131,7],[106,0,132,5],[107,0,133,3],[109,0,135,2],[109,8,135,6,"pendingBlobs"],[109,20,135,18],[109,23,135,21],[109,24,135,2],[110,0,136,2],[110,8,136,6,"bloblessData"],[110,20,136,18],[110,23,136,21,"data"],[110,27,136,2],[112,0,137,2,"_removeBlobs"],[112,4,137,2,"_removeBlobs"],[112,16,137,14],[112,17,137,15,"bloblessData"],[112,29,137,14],[112,30,137,2],[114,0,138,2],[114,8,138,6],[114,9,138,7,"pendingBlobs"],[114,21,138,2],[114,23,138,21],[115,0,139,4,"callback"],[115,6,139,4,"callback"],[115,14,139,12],[115,15,139,13,"bloblessData"],[115,27,139,12],[115,28,139,4],[116,0,140,3],[117,0,141,1],[117,3,98,0]]},"type":"js/module"}]}